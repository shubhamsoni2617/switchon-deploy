{"ast":null,"code":"import _regeneratorRuntime from\"/home/shubh/switchon/switchon-server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/shubh/switchon/switchon-server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/shubh/switchon/switchon-server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import\"./style.css\";import makeToast from\"../../Toaster\";import{getToken,Axios}from\"../../utils\";import{useHistory}from\"react-router-dom\";import LoaderModal from\"../../loader-modal/LoaderModal\";var FormPage=function FormPage(_ref){var state=_ref.state,dispatch=_ref.dispatch,socket=_ref.socket;var _state$user=state.user,user=_state$user===void 0?{}:_state$user,_state$departments=state.departments,departments=_state$departments===void 0?[]:_state$departments,_state$usersOfOtherDe=state.usersOfOtherDepartment,usersOfOtherDepartment=_state$usersOfOtherDe===void 0?[]:_state$usersOfOtherDe;var _useState=useState(\"Select\"),_useState2=_slicedToArray(_useState,2),assignTo=_useState2[0],setAssignTo=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),validationError=_useState6[0],setValidationError=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var history=useHistory();var handleValidation=function handleValidation(){if(assignTo===\"Select\")return setValidationError(true);if(!message)return setValidationError(true);setValidationError(false);return true;};var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);_context.next=4;return Axios.post(\"/form\",{message:message,department:departments.find(function(department){return department!==user.department;}),approverId:assignTo,approverName:usersOfOtherDepartment.find(function(user){return user.approverId===assignTo;}).username},{headers:{Authorization:\"Bearer \"+getToken()}});case 4:response=_context.sent;socket.emit(\"formSubmit\",{response:response.data.formData});dispatch({type:\"UPDATE_PENDING_REQUESTS\",payload:response.data.formData});setMessage(\"\");setAssignTo(\"Select\");setLoading(false);makeToast(\"success\",response.data.message);history.push(\"/pending\");_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);if(_context.t0&&_context.t0.response&&_context.t0.response.data&&_context.t0.response.data.message){setLoading(false);makeToast(\"error\",_context.t0.response.data.message);}case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function onSubmit(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(\"div\",{className:\"card form\"},/*#__PURE__*/React.createElement(LoaderModal,{isLoading:loading}),/*#__PURE__*/React.createElement(\"div\",{className:\"cardHeader\"},\"Form\"),/*#__PURE__*/React.createElement(\"div\",{className:\"cardBody\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inputGroup\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"name\"},\"Created By\"),user.username&&/*#__PURE__*/React.createElement(\"input\",{name:\"name\",value:user.username,disabled:true,placeholder:\"John Doe\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"inputGroup\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"department\"},\"Department To Assign\"),user.department&&/*#__PURE__*/React.createElement(\"input\",{name:\"department\",value:departments.find(function(department){return department!==user.department;}),disabled:true,placeholder:\"John Doe\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"select\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"department\"},\"Assign To\"),/*#__PURE__*/React.createElement(\"select\",{value:assignTo,placeholder:\"select\",onChange:function onChange(_ref3){var target=_ref3.target;return setAssignTo(target.value);}},/*#__PURE__*/React.createElement(\"option\",{disabled:true},\"Select\"),usersOfOtherDepartment.map(function(user){return/*#__PURE__*/React.createElement(\"option\",{key:user.approverId,value:user.approverId},user.username);}))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputGroup\"},/*#__PURE__*/React.createElement(\"label\",null,\"Message\"),/*#__PURE__*/React.createElement(\"textarea\",{onChange:function onChange(_ref4){var target=_ref4.target;return setMessage(target.value);},value:message,placeholder:\"Type your message here...\"})),validationError&&/*#__PURE__*/React.createElement(\"p\",{className:\"error\"},\"All fields are required\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){handleValidation()&&onSubmit();}},\"Submit\")));};export default FormPage;","map":{"version":3,"sources":["/home/shubh/switchon/switchon-server/client/src/Pages/form-page/index.js"],"names":["React","useState","makeToast","getToken","Axios","useHistory","LoaderModal","FormPage","state","dispatch","socket","user","departments","usersOfOtherDepartment","assignTo","setAssignTo","message","setMessage","validationError","setValidationError","loading","setLoading","history","handleValidation","onSubmit","post","department","find","approverId","approverName","username","headers","Authorization","response","emit","data","formData","type","payload","push","target","value","map"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport \"./style.css\";\nimport makeToast from \"../../Toaster\";\nimport { getToken, Axios } from \"../../utils\";\nimport { useHistory } from \"react-router-dom\";\nimport LoaderModal from \"../../loader-modal/LoaderModal\";\n\nconst FormPage = ({ state, dispatch, socket }) => {\n  const { user = {}, departments = [], usersOfOtherDepartment = [] } = state;\n  const [assignTo, setAssignTo] = useState(\"Select\");\n  const [message, setMessage] = useState(\"\");\n  const [validationError, setValidationError] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  const history = useHistory();\n  const handleValidation = () => {\n    if (assignTo === \"Select\") return setValidationError(true);\n    if (!message) return setValidationError(true);\n    setValidationError(false);\n    return true;\n  };\n\n  const onSubmit = async () => {\n    try {\n      setLoading(true);\n\n      const response = await Axios.post(\n        \"/form\",\n        {\n          message,\n          department: departments.find(\n            (department) => department !== user.department\n          ),\n\n          approverId: assignTo,\n          approverName: usersOfOtherDepartment.find(\n            (user) => user.approverId === assignTo\n          ).username,\n        },\n        {\n          headers: {\n            Authorization: \"Bearer \" + getToken(),\n          },\n        }\n      );\n\n      socket.emit(\"formSubmit\", {\n        response: response.data.formData,\n      });\n      dispatch({\n        type: \"UPDATE_PENDING_REQUESTS\",\n        payload: response.data.formData,\n      });\n      setMessage(\"\");\n      setAssignTo(\"Select\");\n      setLoading(false);\n\n      makeToast(\"success\", response.data.message);\n      history.push(\"/pending\");\n    } catch (err) {\n      if (\n        err &&\n        err.response &&\n        err.response.data &&\n        err.response.data.message\n      ) {\n        setLoading(false);\n        makeToast(\"error\", err.response.data.message);\n      }\n    }\n  };\n\n  return (\n    <div className=\"card form\">\n      <LoaderModal isLoading={loading} />\n      <div className=\"cardHeader\">Form</div>\n      <div className=\"cardBody\">\n        <div className=\"inputGroup\">\n          <label htmlFor=\"name\">Created By</label>\n          {user.username && (\n            <input\n              name=\"name\"\n              value={user.username}\n              disabled\n              placeholder=\"John Doe\"\n            />\n          )}\n        </div>\n        <div className=\"inputGroup\">\n          <label htmlFor=\"department\">Department To Assign</label>\n          {user.department && (\n            <input\n              name=\"department\"\n              value={departments.find(\n                (department) => department !== user.department\n              )}\n              disabled\n              placeholder=\"John Doe\"\n            />\n          )}\n        </div>\n\n        <div className=\"select\">\n          <label htmlFor=\"department\">Assign To</label>\n          <select\n            value={assignTo}\n            placeholder=\"select\"\n            onChange={({ target }) => setAssignTo(target.value)}\n          >\n            <option disabled>Select</option>\n            {usersOfOtherDepartment.map((user) => (\n              <option key={user.approverId} value={user.approverId}>\n                {user.username}\n              </option>\n            ))}\n          </select>\n        </div>\n        <div className=\"inputGroup\">\n          <label>Message</label>\n          <textarea\n            onChange={({ target }) => setMessage(target.value)}\n            value={message}\n            placeholder=\"Type your message here...\"\n          />\n        </div>\n        {validationError && <p className=\"error\">All fields are required</p>}\n        <button\n          onClick={() => {\n            handleValidation() && onSubmit();\n          }}\n        >\n          Submit\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default FormPage;\n"]},"metadata":{},"sourceType":"module"}