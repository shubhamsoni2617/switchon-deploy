{"ast":null,"code":"import _regeneratorRuntime from\"/home/shubh/switchon/switchon-server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/shubh/switchon/switchon-server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/shubh/switchon/switchon-server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useReducer}from\"react\";import{Switch,Route,Redirect,useHistory}from\"react-router-dom\";import io from\"socket.io-client\";import makeToast from\"./Toaster\";import LoginPage from\"./Pages/authentication/login-page\";import FormPage from\"./Pages/form-page\";import PrivateRoute from\"./PrivateRoute\";import SignupPage from\"./Pages/authentication/signup-page\";import{getToken,Axios}from\"./utils\";import{reducer,initialState}from\"./reducer\";import PendingPage from\"./Pages/user-form-status/Pending\";import ApprovedPage from\"./Pages/user-form-status/Approved\";import RejectedPage from\"./Pages/user-form-status/Rejected\";import ApprovalRequest from\"./Pages/approval-request\";import Notifications from\"./Pages/notifications\";import LoaderModal from\"./loader-modal/LoaderModal\";var Routes=function Routes(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),socket=_useState2[0],setSocket=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var history=useHistory();var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var setupSocket=function setupSocket(){if(!socket){var newSocket=io(\"http://localhost:8000\",{query:{token:getToken()}});newSocket.on(\"disconnect\",function(){setSocket(null);setTimeout(setupSocket,3000);// makeToast(\"error\", \"Socket Disconnected!\");\n});newSocket.on(\"connect\",function(){// makeToast(\"success\", \"Socket Connected!\");\n});setSocket(newSocket);}};useEffect(function(){var fetchUserData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(getToken()){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.prev=2;setLoading(true);_context.next=6;return Axios.get(\"/userdata\",{headers:{Authorization:\"Bearer \"+getToken()}});case 6:response=_context.sent;dispatch({type:\"SET_USER_DATA\",payload:response.data});setupSocket();setLoading(false);_context.next=21;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](2);setLoading(false);console.log(111,history.location.pathname);sessionStorage.clear();if(!(history.location.pathname===\"/login\"||history.location.pathname===\"/signup\")){_context.next=19;break;}return _context.abrupt(\"return\");case 19:makeToast(\"error\",\"User not authenticated\");history.push(\"/login\");case 21:case\"end\":return _context.stop();}}},_callee,null,[[2,12]]);}));return function fetchUserData(){return _ref.apply(this,arguments);};}();fetchUserData();// eslint-disable-next-line\n},[]);useEffect(function(){if(socket){socket.on(\"approvalDepartment\",function(payload){dispatch({type:\"UPDATE_APPROVAL_REQUESTS\",payload:payload});});socket.on(\"stateUpdated\",function(payload){dispatch({type:\"UPDATE_USER_FORMS\",payload:payload});});socket.on(\"notification\",function(payload){dispatch({type:\"UPDATE_NOTIFICATIONS\",payload:payload});makeToast(\"info\",\"New Notification\");});socket.on(\"newUser\",function(payload){makeToast(\"info\",\"New user registered\");dispatch({type:\"UPDATE_OTHER_DEPARTMENT_USER\",payload:payload});});}},[socket]);return/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(LoaderModal,{isLoading:loading}),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Redirect,{from:\"/\",to:\"/\".concat(getToken()?\"form\":\"login\"),exact:true}),/*#__PURE__*/React.createElement(Route,{path:\"/login\",render:function render(props){return/*#__PURE__*/React.createElement(LoginPage,Object.assign({setupSocket:setupSocket,dispatch:dispatch},props));},exact:true}),/*#__PURE__*/React.createElement(Route,{path:\"/signup\",render:function render(props){return/*#__PURE__*/React.createElement(SignupPage,Object.assign({},props,{socket:socket,exact:true}));}}),/*#__PURE__*/React.createElement(PrivateRoute,{path:\"/form\",component:FormPage,compProps:{state:state,dispatch:dispatch,socket:socket},exact:true}),/*#__PURE__*/React.createElement(PrivateRoute,{path:\"/pending\",component:PendingPage,compProps:{pending:state.pending},exact:true}),/*#__PURE__*/React.createElement(PrivateRoute,{path:\"/rejected\",component:RejectedPage,compProps:{rejected:state.rejected},exact:true}),/*#__PURE__*/React.createElement(PrivateRoute,{path:\"/approved\",component:ApprovedPage,compProps:{approved:state.approved},exact:true}),/*#__PURE__*/React.createElement(PrivateRoute,{path:\"/request\",component:ApprovalRequest,compProps:{approvalRequest:state.approvalRequest,userId:state.user._id,socket:socket,dispatch:dispatch},exact:true}),/*#__PURE__*/React.createElement(PrivateRoute,{path:\"/notifications\",component:Notifications,compProps:{notifications:state.notifications,username:state.user.username},exact:true})));};export default Routes;","map":{"version":3,"sources":["/home/shubh/switchon/switchon-server/client/src/Routes.js"],"names":["React","useState","useEffect","useReducer","Switch","Route","Redirect","useHistory","io","makeToast","LoginPage","FormPage","PrivateRoute","SignupPage","getToken","Axios","reducer","initialState","PendingPage","ApprovedPage","RejectedPage","ApprovalRequest","Notifications","LoaderModal","Routes","socket","setSocket","loading","setLoading","history","state","dispatch","setupSocket","newSocket","query","token","on","setTimeout","fetchUserData","get","headers","Authorization","response","type","payload","data","console","log","location","pathname","sessionStorage","clear","push","props","pending","rejected","approved","approvalRequest","userId","user","_id","notifications","username"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useReducer } from \"react\";\nimport { Switch, Route, Redirect, useHistory } from \"react-router-dom\";\nimport io from \"socket.io-client\";\nimport makeToast from \"./Toaster\";\nimport LoginPage from \"./Pages/authentication/login-page\";\nimport FormPage from \"./Pages/form-page\";\nimport PrivateRoute from \"./PrivateRoute\";\nimport SignupPage from \"./Pages/authentication/signup-page\";\nimport { getToken, Axios } from \"./utils\";\nimport { reducer, initialState } from \"./reducer\";\nimport PendingPage from \"./Pages/user-form-status/Pending\";\nimport ApprovedPage from \"./Pages/user-form-status/Approved\";\nimport RejectedPage from \"./Pages/user-form-status/Rejected\";\nimport ApprovalRequest from \"./Pages/approval-request\";\nimport Notifications from \"./Pages/notifications\";\nimport LoaderModal from \"./loader-modal/LoaderModal\";\n\nconst Routes = () => {\n  const [socket, setSocket] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const history = useHistory();\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const setupSocket = () => {\n    if (!socket) {\n      const newSocket = io(\"http://localhost:8000\", {\n        query: {\n          token: getToken(),\n        },\n      });\n\n      newSocket.on(\"disconnect\", () => {\n        setSocket(null);\n        setTimeout(setupSocket, 3000);\n        // makeToast(\"error\", \"Socket Disconnected!\");\n      });\n\n      newSocket.on(\"connect\", () => {\n        // makeToast(\"success\", \"Socket Connected!\");\n      });\n      setSocket(newSocket);\n    }\n  };\n\n  useEffect(() => {\n    const fetchUserData = async () => {\n      if (!getToken()) return;\n      try {\n        setLoading(true);\n        const response = await Axios.get(\"/userdata\", {\n          headers: {\n            Authorization: \"Bearer \" + getToken(),\n          },\n        });\n\n        dispatch({\n          type: \"SET_USER_DATA\",\n          payload: response.data,\n        });\n        setupSocket();\n        setLoading(false);\n      } catch (error) {\n        setLoading(false);\n        console.log(111, history.location.pathname);\n        sessionStorage.clear();\n        if (\n          history.location.pathname === \"/login\" ||\n          history.location.pathname === \"/signup\"\n        )\n          return;\n        makeToast(\"error\", \"User not authenticated\");\n        history.push(\"/login\");\n      }\n    };\n    fetchUserData();\n    // eslint-disable-next-line\n  }, []);\n\n  useEffect(() => {\n    if (socket) {\n      socket.on(\"approvalDepartment\", (payload) => {\n        dispatch({\n          type: \"UPDATE_APPROVAL_REQUESTS\",\n          payload,\n        });\n      });\n\n      socket.on(\"stateUpdated\", (payload) => {\n        dispatch({\n          type: \"UPDATE_USER_FORMS\",\n          payload,\n        });\n      });\n\n      socket.on(\"notification\", (payload) => {\n        dispatch({\n          type: \"UPDATE_NOTIFICATIONS\",\n          payload,\n        });\n        makeToast(\"info\", \"New Notification\");\n      });\n\n      socket.on(\"newUser\", (payload) => {\n        makeToast(\"info\", \"New user registered\");\n        dispatch({\n          type: \"UPDATE_OTHER_DEPARTMENT_USER\",\n          payload,\n        });\n      });\n    }\n  }, [socket]);\n  return (\n    <div className=\"container\">\n      <LoaderModal isLoading={loading} />\n      <Switch>\n        <Redirect from=\"/\" to={`/${getToken() ? `form` : `login`}`} exact />\n        <Route\n          path=\"/login\"\n          render={(props) => (\n            <LoginPage\n              setupSocket={setupSocket}\n              dispatch={dispatch}\n              {...props}\n            />\n          )}\n          exact\n        />\n        <Route\n          path=\"/signup\"\n          render={(props) => <SignupPage {...props} socket={socket} exact />}\n        />\n        <PrivateRoute\n          path=\"/form\"\n          component={FormPage}\n          compProps={{ state, dispatch, socket }}\n          exact\n        />\n        <PrivateRoute\n          path=\"/pending\"\n          component={PendingPage}\n          compProps={{ pending: state.pending }}\n          exact\n        />\n        <PrivateRoute\n          path=\"/rejected\"\n          component={RejectedPage}\n          compProps={{ rejected: state.rejected }}\n          exact\n        />\n        <PrivateRoute\n          path=\"/approved\"\n          component={ApprovedPage}\n          compProps={{ approved: state.approved }}\n          exact\n        />\n        <PrivateRoute\n          path=\"/request\"\n          component={ApprovalRequest}\n          compProps={{\n            approvalRequest: state.approvalRequest,\n            userId: state.user._id,\n            socket,\n            dispatch,\n          }}\n          exact\n        />\n        <PrivateRoute\n          path=\"/notifications\"\n          component={Notifications}\n          compProps={{\n            notifications: state.notifications,\n            username: state.user.username,\n          }}\n          exact\n        />\n      </Switch>\n    </div>\n  );\n};\n\nexport default Routes;\n"]},"metadata":{},"sourceType":"module"}